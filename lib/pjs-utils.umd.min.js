/*!
 * @panjingshuang/pjs-utils v1.0.2
 * (c) 2014-2024 @panjingshuang/pjs-utils
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["pjs-utils"]={})}(this,(function(e){"use strict";function t(e,t="png",n=1){return t?e.toDataURL("image/"+t,Number(n)):e.toDataURL()}var n={width:750,height:1334,designScale:2,adaptiveScale:2,clientWidth:document.documentElement.clientWidth||document.body.clientWidth,clientHeight:document.documentElement.clientHeight||document.body.clientHeight};n.adaptiveScale=n.width/n.clientWidth,e.Barrage=function(e){if(!e.id)return void console.log("function Barrage need id!");let t="barrage",o="barrage-b",i=document.getElementById(e.id);if(setDomStyles(i,{position:"relative",overflow:"hidden"}),e.textSize=e.textSize||20,e.duration=e.duration||10,e.num=e.num||5,e.duration=e.duration||12,e.content)return this.content=e.content,function(){let n,s,r=content.length;time=r/2/e.num,r/2%e.num!=0&&(time+=1);for(s=0;s<Math.ceil(r/2);s++)n=l(content[s],t+"-"+Math.floor(s/e.num),s%e.num),i.appendChild(n);for(let t=0;t<Math.floor(r/2);t++)n=l(content[t+s],o+"-"+Math.floor(t/e.num),t%e.num),i.appendChild(n)}(),window.setTimeout((()=>{s("."+t+"-0",0,t),e.num>1&&window.setTimeout((()=>{s("."+o+"-0",0,o)}),1e3*e.duration/2)}),500),{destroy:function(){t="",o="",count=0,num=0,e=null,fontFamily="",document.getElementsByClassName("barrage-item").forEach((e=>{window.gsap.killTweensOf(e)}))}};function l(t,o,l){let s,r=e.fontColor,a=e.textSize,d=parseInt(i.clientWidth);if(Array.isArray(r)){let e=r.length,t=random(0,e-1);console.log(t),s=r[t]}else s=r||"black";if(Array.isArray(a)){let e=a.length;a=a[random(0,e-1)]/n.adaptiveScale}else a/=n.adaptiveScale;let c={position:"absolute",top:parseInt(i.clientHeight)/e.num*l+"px",left:d+"px",fontSize:a+"px",whiteSpace:"nowrap",color:s},m=document.createElement("span");return m.classList.add(o,"barrage-item"),setDomStyles(m,c),m.innerHTML=t,m}function s(t,n=0,o){e&&e.duration&&e.duration,window.gsap.to(t,{x:function(e){let n=document.querySelectorAll(t);return-(parseFloat(n[e].clientWidth)+parseFloat(i.clientWidth))},duration:e.duration,ease:"none",yoyo:!1,stagger:e.num,onComplete:function(){!function(e,t){window.gsap.to("."+e+"-"+t,{x:0,y:0,duration:0,delay:0})}(o,n);let e=n+1;e>=Math.floor(time)?s("."+o+"-0",0,o):s("."+o+"-"+e,e,o)}})}},e.TwistedEggMatter=function(e){if(!e.id)return console.log("function TwistedEggMatter need params of id "),null;if(!window.Matter)return void console.log("function TwistedEggMatter need to introduce Matter.js!");const t=e.imgs,n=getRealPx(e.ballWidth)*e.ratio,o=e.width,i=e.height,l=parseInt(e.gravityY);document.documentElement.style;let s=window.Matter,r=s.Engine,a=s.Render,d=s.Runner,c=s.World,m=s.Bodies,u=s.Composite,f=r.create(),p=document.getElementById(e.id);console.log(p);let y=a.create({element:p,engine:f,options:{width:getRealPx(o),height:getRealPx(i),wireframes:!1,background:"transparent"}});f.world.gravity.x=0,f.world.gravity.y=.5;const g=[];let h=-1,w=t.length,S=[122.78585140770514,209.3235376646257,326.01634544621396,101.52559109065926,188.39323934095015,282.38697650836866],x=[183.38542746227944,230.06200548401105,207.91038110198647,279.55905905222403,326.1084787517811,296.24269011459813];for(let l=0;l<w;l++){let s=o/400*S[l],r=i/400*x[l],a=m.circle(s,r,n/2,{friction:.001,frictionAir:.005,restitution:.9,density:.05,render:{strokeStyle:"red",lineWidth:0,sprite:{texture:t[l],xScale:e.scale?e.scale:.9,yScale:e.scale?e.scale:.9}}});g.push(a)}let b=Math.min(o,i),I=b*(1/4.5*2);const v=2*Math.PI;let E,k,C,D,T,L,M;for(h=0;h<64;h++)E=v/64,k=h/64*v+E/2,C=Math.cos(k),D=Math.sin(k),T=C*I+o/2,L=D*I+i/2,A({x:T,y:L,w:.01*b,h:.4*b,options:{angle:k,isStatic:!0,density:1,render:{fillStyle:"red",strokeStyle:"transparent",lineWidth:1}}});function A({x:e=0,y:t=0,w:n=10,h:o=10,options:i={}}={}){let l=m.rectangle(e,t,n,o,i);return function(...e){c.add(f.world,...e)}(l),l}return u.add(f.world,g),a.run(y),a.lookAt(y,u.allBodies(f.world)),{start:function(e=(()=>{})){M||(M=d.create()),d.run(M,f);let t=g,n=0;for(let e=0;e<2*t.length;e++)window.setTimeout((()=>{var n;n=t[e%t.length],s.Body.applyForce(n,n.position,{x:0,y:-Math.random()*l})}),n),n+=100;window.setTimeout((()=>{d.stop(M),e()}),3*n)}}},e.canvasImgInLocal=function(e,n=(e=>{})){if(!window.html2canvas)return void console.log("function canvasImgInLocal need to introduce html2canvas.js!");let o=document.getElementById(e.canvasId);const i=o||document.documentElement.body;let l=[];e.hiddenCompIds&&(l=e.hiddenCompIds.split(",")),window.setTimeout((()=>{window.html2canvas(i,{backgroundColor:e.saveImgBgColor||null,useCORS:!0,async:!0,logging:!1,ignoreElements:e=>!!(l.length>0&&e.id&&l.indexOf(e.id)>-1)}).then((o=>{const i=t(o);if(e.repalceId){let t=document.getElementById(e.repalceId);if(t){if(t instanceof HTMLImageElement)t.src=i;else if(t instanceof HTMLCanvasElement){t.getContext("2d").drawImage(o,0,0)}}else console.log("canvas repalce dom can not find!")}n({canvas:o,url:i})}))}),e.timeOut||0)},e.clipboardCopy=async function(e,t,n){let o=document.getElementById(e),i="";i=o?o.innerHTML||o.innerText:e,!function(e){const t=document.createElement("span");t.textContent=e,t.style.whiteSpace="pre",t.style.webkitUserSelect="auto",t.style.userSelect="all",document.body.appendChild(t);const n=window.getSelection(),o=window.document.createRange();n.removeAllRanges(),o.selectNode(t),n.addRange(o);let i=!1;try{i=window.document.execCommand("copy")}finally{n.removeAllRanges(),window.document.body.removeChild(t)}if(!i)throw makeError();return i}(i)?n&&n():t&&t(i)},e.forEachCanReturn=(e,t)=>{for(let n of e)if(t(n))return t(n)},e.getBase64ByType=t,e.mergeByShallow=(e,t)=>{let n=JSON.stringify(t);JSON.stringify(n);for(let n in t)e[n]=t[n]},e.onLotterty=function(e){const t=[0,1,2,7,8,3,6,5,4];let n=[],o=[],i=null,l=null,s=0,r=null,a=-1,d=null;if(e.id){let o=document.getElementById(e.id);if(setDomStyles(o,{display:"flex","justify-content":"space-between","align-items":"center","flex-wrap":"wrap"}),o){if(o.childNodes.length>0)return;for(let i=0;i<9;i++){let l,s,r=document.createElement("div");if(r.setAttribute("lottery_index",t[i]),e.itemWidth)l=getRealPx(e.itemWidth)+"px",s=getRealPx(e.itemHeight)+"px";else{let t=parseInt(o.offsetWidth),n=parseInt(o.offsetHeight),i=e.ratio?e.ratio:.99;l=t/3*i+"px",s=n/3*i+"px"}setDomStyles(r,{display:"inline-block",position:"relative",width:l,height:s,"flex-shrink":1});let a=document.createElement("img"),d=document.createElement("img");setDomStyles(a,{position:"absolute",left:0,top:0,width:"100%",height:"100%",display:"none",zIndex:20}),setDomStyles(d,{position:"absolute",left:0,top:0,width:"100%",height:"100%",zIndex:1}),e.lotteryList?(e.lotteryList[i]&&(setDomAttrubites(a,{src:e.lotteryList[i][0],lottery_status:"light"}),setDomAttrubites(d,{src:e.lotteryList[i][1],lottery_status:"unlight"})),r.appendChild(a),r.appendChild(d)):console.log("onLottery need params lotteryList!"),n.push(r),o.appendChild(r)}}else console.log("onLottery params need id")}if(e.time=!e.time||e.time<3?3:e.time,e.times=!e.times||e.times<2?2:e.times,n.length){let t=n.sort(((e,t)=>parseInt(e.getAttribute("lottery_index"))-parseInt(t.getAttribute("lottery_index"))));o=[...t],i=o.pop(),l=i.childNodes[0],e.onclick&&l.addEventListener("click",(function(t){if(t.preventDefault(),t.stopPropagation(),i){if(e.onclick){setDomStyles(l,{display:"none"}),(0,e.onclick)()}}else console.log("emitClick cant find lottery dom!")}))}function c(e){if(o.forEach((e=>{let t=e.childNodes[0];setDomStyles(t,{display:"none"})})),e>=0){const t=o[e];setDomStyles(t.childNodes[0],{display:"block"})}}function m(t,n=(()=>{})){t<0&&(t=e.thanksIndex);const i=o.length,l=i*(e.times-2)+t;if(c(s%i),l==a&&0==l)u(),n();else{const o=1e3*e.time,i=parseInt(e.time/2*1e3/l),c=parseInt(500*((r=(r=a*i)/o-1)*r*r+1)+300);d=window.setTimeout((()=>{m(t,n),s++,a++,a>=l&&(n(),u(),window.clearTimeout(d))}),c)}var r}function u(){let t={};e.LotteryTime>=1?t.display="block":t.display="none",setDomStyles(l,t)}return n.forEach(((t,n)=>{let o=parseInt(t.getAttribute("lottery_index")),i=t.childNodes[0],l=t.childNodes[1];8==o?e.LotteryTime>=1?setDomStyles(i,{display:"block"}):setDomStyles(i,{display:"none"}):(setDomStyles(i,{display:"none"}),setDomStyles(l,{display:"block"}))})),{start:function(t,n=(()=>{})){const i=o.length,l=i*e.times,d=parseInt(1e3*e.time/l);s=e.isFirst?0:a,r=window.setInterval((()=>{c(s%i),s>=l&&(window.clearInterval(r),a=0,m(t,n)),s++}),d)},setLotteryTime:function(t){e.LotteryTime=parseInt(t),u()}}},e.pjs_random=function(e,t){return Math.round(Math.random()*t+e)},e.setDomAttrubites=function(e,t){if(e)for(let n of Object.keys(t))e.setAttribute(n,t[n]);else console.log("setDomStyle cant find params dom!")},e.setDomStyles=function(e,t){if(e)for(let n of Object.keys(t))e.style[n]=t[n];else console.log("setDomStyle cant find params dom!")}}));
